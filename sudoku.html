<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life is Sudoku Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 24px;
            padding: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.07),
                0 1px 2px rgba(0, 0, 0, 0.05) inset;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 0;
        }

        .info-value {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 2px;
            background: #333;
            padding: 2px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                0 0 0 2px #333;
        }

        .cell {
            aspect-ratio: 1;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            position: relative;
        }

        .cell:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .cell.selected {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .cell.fixed {
            background: #f5f5f5;
            color: #333;
            font-weight: 900;
        }

        .cell.error {
            background: #ff6b6b;
            color: white;
        }

        .cell.same-number {
            background: #d4e6ff;
        }

        .cell.ai-thinking {
            background: #fff3cd;
            animation: aiPulse 0.5s ease-in-out;
        }

        .cell.ai-placed {
            background: #d4edda;
            animation: aiPlace 0.3s ease;
        }

        @keyframes aiPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes aiPlace {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* 3x3 ë¸”ë¡ êµ¬ë¶„ */
        .cell:nth-child(3n) {
            border-right: 2px solid #333;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #333;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .number-btn, .control-btn {
            padding: 12px 8px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .number-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .number-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(102, 126, 234, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .number-btn:active {
            transform: translateY(0);
        }

        .control-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(245, 87, 108, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .control-btn.new-game {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .difficulty-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            background: #f5f5f5;
            color: #666;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 11px;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 6px rgba(102, 126, 234, 0.3);
        }

        .difficulty-btn-modal {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            background: #f5f5f5;
            color: #666;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        .difficulty-btn-modal.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .records {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) inset;
        }

        .records h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        #settingsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 22px;
                margin-bottom: 12px;
            }

            .cell {
                font-size: 16px;
            }

            .number-btn {
                padding: 10px 6px;
                font-size: 14px;
            }

            .control-btn {
                padding: 10px 6px;
                font-size: 13px;
            }

            .info-label {
                font-size: 10px !important;
            }

            .info-value {
                font-size: 13px !important;
            }

            .difficulty-btn, .difficulty-btn-modal {
                padding: 3px 6px !important;
                font-size: 10px !important;
                min-width: 40px !important;
            }

            .game-info {
                padding: 5px 10px !important;
                gap: 8px;
            }

            .info-item {
                gap: 3px !important;
            }

            .number-pad {
                gap: 3px;
            }

            #settingsBtn {
                font-size: 16px !important;
                padding: 6px 10px !important;
            }
        }

        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .victory-modal.show {
            display: flex;
        }

        .victory-content {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: victoryPop 0.5s ease;
        }

        @keyframes victoryPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .victory-content h2 {
            color: #667eea;
            font-size: 36px;
            margin-bottom: 20px;
        }

        .victory-content p {
            font-size: 20px;
            color: #666;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Life is Sudoku Game</h1>
        
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 15px; align-items: center;">
            <div class="game-info" style="margin-bottom: 0; padding: 6px 12px;">
                <div class="info-item" style="display: flex; gap: 5px; align-items: center;">
                    <div class="info-label" style="font-size: 11px; margin-bottom: 0;">ì‹œê°„</div>
                    <div class="info-value" style="font-size: 14px;" id="timer">00:00</div>
                </div>
                <div class="info-item" style="display: flex; gap: 5px; align-items: center;">
                    <div class="info-label" style="font-size: 11px; margin-bottom: 0;">ë‚œì´ë„</div>
                    <div class="info-value" style="font-size: 14px;" id="difficulty">ì‰¬ì›€</div>
                </div>
                <div class="info-item" style="display: flex; gap: 5px; align-items: center;">
                    <div class="info-label" style="font-size: 11px; margin-bottom: 0;">ì‹¤ìˆ˜</div>
                    <div class="info-value" style="font-size: 14px;" id="mistakes">0</div>
                </div>
            </div>

            <button id="settingsBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-size: 18px; box-shadow: 0 3px 6px rgba(102, 126, 234, 0.3); transition: all 0.2s ease;">
                âš™ï¸
            </button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
            <button class="control-btn" id="erase" style="font-size: 14px; padding: 12px 8px;">ì§€ìš°ê¸°</button>
            <button class="control-btn new-game" id="newGame" style="font-size: 14px; padding: 12px 8px;">ìƒˆ ê²Œì„</button>
            <div style="position: relative;">
                <button class="control-btn" id="aiSolve" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); font-size: 14px; padding: 12px 8px; width: 100%;">
                    ğŸ¤– AI í’€ì´
                </button>
                <button class="control-btn" id="stopAi" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); font-size: 14px; padding: 12px 8px; width: 100%; display: none;">
                    â¸ï¸ ì¤‘ì§€
                </button>
            </div>
        </div>

        <div class="sudoku-board" id="board"></div>

        <div class="number-pad">
            <button class="number-btn" data-number="1">1</button>
            <button class="number-btn" data-number="2">2</button>
            <button class="number-btn" data-number="3">3</button>
            <button class="number-btn" data-number="4">4</button>
            <button class="number-btn" data-number="5">5</button>
            <button class="number-btn" data-number="6">6</button>
            <button class="number-btn" data-number="7">7</button>
            <button class="number-btn" data-number="8">8</button>
            <button class="number-btn" data-number="9">9</button>
        </div>

        <div class="records">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <h3 style="margin: 0;">ğŸ† ìµœê³  ê¸°ë¡</h3>
                <button id="clearRecordsBtn" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 11px; font-weight: bold; box-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);">
                    ğŸ—‘ï¸ ì‚­ì œ
                </button>
            </div>
            <div id="recordsList"></div>
        </div>
    </div>

    <div class="victory-modal" id="victoryModal">
        <div class="victory-content">
            <h2>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <p id="victoryMessage"></p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                <button class="control-btn" onclick="closeVictoryModal()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">ì™„ë£Œ</button>
                <button class="control-btn new-game" onclick="newGame()">ìƒˆ ê²Œì„</button>
            </div>
        </div>
    </div>

    <div class="victory-modal" id="settingsModal">
        <div class="victory-content">
            <h2>âš™ï¸ ì„¤ì •</h2>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #667eea; font-weight: bold; margin-bottom: 10px; font-size: 16px;">ë‚œì´ë„</label>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <button class="difficulty-btn-modal active" data-level="easy">ì‰¬ì›€</button>
                    <button class="difficulty-btn-modal" data-level="medium">ë³´í†µ</button>
                    <button class="difficulty-btn-modal" data-level="hard">ì–´ë ¤ì›€</button>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="color: #667eea; font-weight: bold; font-size: 16px;">AI ì†ë„</label>
                    <span id="speedValueModal" style="color: #666; font-size: 14px;">ë³´í†µ</span>
                </div>
                <input type="range" id="aiSpeedModal" min="1" max="5" value="3" step="1" 
                       style="width: 100%; accent-color: #667eea;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #999; margin-top: 5px;">
                    <span>ëŠë¦¼</span>
                    <span>ë¹ ë¦„</span>
                </div>
            </div>

            <button class="control-btn new-game" onclick="closeSettingsModal()" style="width: 100%;">ì™„ë£Œ</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let board = [];
        let solution = [];
        let selectedCell = null;
        let currentDifficulty = 'easy';
        let startTime = null;
        let timerInterval = null;
        let mistakes = 0;
        
        // AI í’€ì´ ìƒíƒœ
        let aiSolving = false;
        let aiSteps = [];
        let aiCurrentStep = 0;
        let aiSpeed = 3; // 1(ëŠë¦¼) ~ 5(ë¹ ë¦„)

        // ë‚œì´ë„ë³„ ë¹ˆ ì¹¸ ìˆ˜
        const difficultyLevels = {
            easy: 40,
            medium: 50,
            hard: 60
        };

        // ì‚¬ìš´ë“œ ìƒì„±
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playClickSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function playSuccessSound() {
            const notes = [523.25, 659.25, 783.99]; // C, E, G
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, index * 100);
            });
        }

        function playErrorSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 200;
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // ìŠ¤ë„ì¿  ìƒì„± ì•Œê³ ë¦¬ì¦˜
        function generateSudoku() {
            const grid = Array(9).fill(null).map(() => Array(9).fill(0));
            
            function isValid(grid, row, col, num) {
                // í–‰ ì²´í¬
                for (let x = 0; x < 9; x++) {
                    if (grid[row][x] === num) return false;
                }
                
                // ì—´ ì²´í¬
                for (let x = 0; x < 9; x++) {
                    if (grid[x][col] === num) return false;
                }
                
                // 3x3 ë°•ìŠ¤ ì²´í¬
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (grid[startRow + i][startCol + j] === num) return false;
                    }
                }
                
                return true;
            }
            
            function fillGrid(grid) {
                const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (grid[row][col] === 0) {
                            numbers.sort(() => Math.random() - 0.5);
                            
                            for (let num of numbers) {
                                if (isValid(grid, row, col, num)) {
                                    grid[row][col] = num;
                                    
                                    if (fillGrid(grid)) {
                                        return true;
                                    }
                                    
                                    grid[row][col] = 0;
                                }
                            }
                            
                            return false;
                        }
                    }
                }
                
                return true;
            }
            
            fillGrid(grid);
            return grid;
        }

        function removeCells(grid, count) {
            const puzzle = grid.map(row => [...row]);
            let removed = 0;
            
            while (removed < count) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                
                if (puzzle[row][col] !== 0) {
                    puzzle[row][col] = 0;
                    removed++;
                }
            }
            
            return puzzle;
        }

        function initBoard() {
            solution = generateSudoku();
            board = removeCells(solution, difficultyLevels[currentDifficulty]);
            mistakes = 0;
            updateMistakes();
            renderBoard();
            startTimer();
        }

        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    if (board[row][col] !== 0) {
                        cell.textContent = board[row][col];
                        cell.classList.add('fixed');
                    }
                    
                    cell.addEventListener('click', () => selectCell(row, col));
                    boardElement.appendChild(cell);
                }
            }
        }

        function selectCell(row, col) {
            if (board[row][col] !== 0 && solution[row][col] === board[row][col]) {
                return; // ê³ ì •ëœ ì…€ì€ ì„ íƒ ë¶ˆê°€
            }
            
            playClickSound();
            selectedCell = { row, col };
            updateCellStyles();
        }

        function updateCellStyles() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                cell.classList.remove('selected', 'same-number', 'error');
                
                if (selectedCell && row === selectedCell.row && col === selectedCell.col) {
                    cell.classList.add('selected');
                }
                
                // ê°™ì€ ìˆ«ì í•˜ì´ë¼ì´íŠ¸
                if (selectedCell && board[row][col] !== 0 && 
                    board[row][col] === board[selectedCell.row][selectedCell.col]) {
                    cell.classList.add('same-number');
                }
                
                // ì˜¤ë¥˜ í‘œì‹œ
                if (board[row][col] !== 0 && solution[row][col] !== board[row][col]) {
                    cell.classList.add('error');
                }
            });
        }

        function placeNumber(num) {
            if (!selectedCell || aiSolving) return;  // AI í’€ì´ ì¤‘ì—ëŠ” ì…ë ¥ ë¶ˆê°€
            
            const { row, col } = selectedCell;
            
            // ê³ ì •ëœ ì…€ì€ ìˆ˜ì • ë¶ˆê°€
            if (solution[row][col] === board[row][col] && board[row][col] !== 0) {
                return;
            }
            
            playClickSound();
            
            // ì´ì „ ê°’ì´ ìˆì—ˆëŠ”ì§€ í™•ì¸
            const hadValue = board[row][col] !== 0;
            
            board[row][col] = num;
            
            // í™”ë©´ì— ìˆ«ì í‘œì‹œ
            const cells = document.querySelectorAll('.cell');
            const cellIndex = row * 9 + col;
            cells[cellIndex].textContent = num;
            
            // ì •ë‹µ í™•ì¸
            if (solution[row][col] !== num) {
                if (!hadValue) { // ìƒˆë¡œ ì…ë ¥í•œ ê²½ìš°ë§Œ ì‹¤ìˆ˜ ì¹´ìš´íŠ¸
                    mistakes++;
                    updateMistakes();
                }
                playErrorSound();
            }
            
            updateCellStyles();
            checkVictory();
        }

        function eraseCell() {
            if (!selectedCell || aiSolving) return;  // AI í’€ì´ ì¤‘ì—ëŠ” ì§€ìš°ê¸° ë¶ˆê°€
            
            const { row, col } = selectedCell;
            
            // ê³ ì •ëœ ì…€ì€ ì§€ìš¸ ìˆ˜ ì—†ìŒ
            if (solution[row][col] === board[row][col] && board[row][col] !== 0) {
                return;
            }
            
            playClickSound();
            board[row][col] = 0;
            
            // í™”ë©´ì—ì„œ ìˆ«ì ì œê±°
            const cells = document.querySelectorAll('.cell');
            const cellIndex = row * 9 + col;
            cells[cellIndex].textContent = '';
            
            updateCellStyles();
        }

        function checkVictory() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] !== solution[row][col]) {
                        return false;
                    }
                }
            }
            
            // ìŠ¹ë¦¬!
            stopTimer();
            playSuccessSound();
            
            const time = document.getElementById('timer').textContent;
            saveRecord(currentDifficulty, time, mistakes);
            showVictoryModal(time);
            
            return true;
        }

        // AI í’€ì´ ì•Œê³ ë¦¬ì¦˜ (ë°±íŠ¸ë˜í‚¹)
        // AI í’€ì´ - solutionì„ ê¸°ë°˜ìœ¼ë¡œ ë¹ˆ ì¹¸ë“¤ì„ ì±„ì›Œë‚˜ê°
        function generateAiSteps() {
            const steps = [];
            
            // ë¹ˆ ì¹¸ë“¤ì„ ì°¾ì•„ì„œ ìˆœì„œëŒ€ë¡œ ì±„ìš¸ ëª©ë¡ ë§Œë“¤ê¸°
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] === 0) {
                        // solutionì˜ ì •ë‹µ ìˆ«ìë¡œ ì±„ìš°ê¸°
                        const correctNum = solution[row][col];
                        steps.push({ row, col, num: correctNum, type: 'place' });
                    }
                }
            }
            
            return steps;
        }

        async function startAiSolver() {
            if (aiSolving) return;
            
            aiSolving = true;
            document.getElementById('aiSolve').style.display = 'none';
            document.getElementById('stopAi').style.display = 'block';
            
            // AI í’€ì´ ë‹¨ê³„ ìƒì„±
            aiSteps = generateAiSteps();
            aiCurrentStep = 0;
            
            // ë‹¨ê³„ë³„ ì‹¤í–‰
            await executeAiSteps();
        }

        async function executeAiSteps() {
            const speedMap = {
                1: 500,  // ëŠë¦¼
                2: 300,
                3: 150,  // ë³´í†µ
                4: 50,
                5: 10    // ë¹ ë¦„
            };
            
            const delay = speedMap[aiSpeed];
            
            while (aiCurrentStep < aiSteps.length && aiSolving) {
                const step = aiSteps[aiCurrentStep];
                const { row, col, num } = step;
                
                const cells = document.querySelectorAll('.cell');
                const cellIndex = row * 9 + col;
                const cell = cells[cellIndex];
                
                // ìƒê°í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
                cell.classList.add('ai-thinking');
                await sleep(delay / 2);
                cell.classList.remove('ai-thinking');
                
                // ìˆ«ì ë°°ì¹˜
                board[row][col] = num;
                cell.textContent = num;
                cell.classList.add('ai-placed');
                playClickSound();
                
                await sleep(delay);
                cell.classList.remove('ai-placed');
                
                aiCurrentStep++;
                updateCellStyles();
            }
            
            if (aiSolving) {
                // AI ì™„ë£Œ
                await sleep(500);
                stopAiSolver();
                
                if (checkVictory()) {
                    playSuccessSound();
                }
            }
        }

        function stopAiSolver() {
            aiSolving = false;
            aiSteps = [];
            aiCurrentStep = 0;
            document.getElementById('aiSolve').style.display = 'block';
            document.getElementById('stopAi').style.display = 'none';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showVictoryModal(time) {
            const modal = document.getElementById('victoryModal');
            const message = document.getElementById('victoryMessage');
            message.textContent = `ì™„ë£Œ ì‹œê°„: ${time} | ì‹¤ìˆ˜: ${mistakes}íšŒ`;
            modal.classList.add('show');
        }

        function closeVictoryModal() {
            const modal = document.getElementById('victoryModal');
            modal.classList.remove('show');
        }

        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.classList.add('show');
            
            // í˜„ì¬ ì„¤ì •ê°’ìœ¼ë¡œ ëª¨ë‹¬ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.difficulty-btn-modal').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level === currentDifficulty) {
                    btn.classList.add('active');
                }
            });
            
            document.getElementById('aiSpeedModal').value = aiSpeed;
            updateAiSpeedModal();
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.classList.remove('show');
            saveSettings();
        }

        function loadSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem('sudokuSettings') || '{}');
                
                if (settings.difficulty) {
                    currentDifficulty = settings.difficulty;
                    document.getElementById('difficulty').textContent = 
                        currentDifficulty === 'easy' ? 'ì‰¬ì›€' : 
                        currentDifficulty === 'medium' ? 'ë³´í†µ' : 'ì–´ë ¤ì›€';
                }
                
                if (settings.aiSpeed) {
                    aiSpeed = settings.aiSpeed;
                }
            } catch (e) {
                console.log('Settings not available');
            }
        }

        function saveSettings() {
            try {
                const settings = {
                    difficulty: currentDifficulty,
                    aiSpeed: aiSpeed
                };
                localStorage.setItem('sudokuSettings', JSON.stringify(settings));
            } catch (e) {
                console.log('Cannot save settings');
            }
        }

        function clearAllRecords() {
            if (confirm('ëª¨ë“  ë‚œì´ë„ì˜ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    localStorage.removeItem('sudokuRecords');
                    displayRecords();
                    alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    alert('ê¸°ë¡ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        }

        function updateAiSpeedModal() {
            const speedMap = ['', 'ë§¤ìš° ëŠë¦¼', 'ëŠë¦¼', 'ë³´í†µ', 'ë¹ ë¦„', 'ë§¤ìš° ë¹ ë¦„'];
            document.getElementById('speedValueModal').textContent = speedMap[aiSpeed];
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimer() {
            if (!startTime) return;
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('timer').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateMistakes() {
            document.getElementById('mistakes').textContent = mistakes;
        }

        function newGame() {
            stopTimer();
            stopAiSolver();  // AI í’€ì´ ì¤‘ì´ë©´ ì¤‘ì§€
            document.getElementById('victoryModal').classList.remove('show');
            initBoard();
        }

        function changeDifficulty(level) {
            currentDifficulty = level;
            document.getElementById('difficulty').textContent = 
                level === 'easy' ? 'ì‰¬ì›€' : level === 'medium' ? 'ë³´í†µ' : 'ì–´ë ¤ì›€';
            
            saveSettings();
            displayRecords(); // ë‚œì´ë„ê°€ ë³€ê²½ë˜ë©´ í•´ë‹¹ ë‚œì´ë„ì˜ ê¸°ë¡ í‘œì‹œ
        }

        function saveRecord(difficulty, time, mistakes) {
            // localStorageë¥¼ ì‚¬ìš©í•œ ê¸°ë¡ ì €ì¥
            // ì£¼ì˜: Claude.ai artifactì—ì„œëŠ” localStorageê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
            // ì´ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•´ì„œ ì§ì ‘ ì—´ë©´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤
            try {
                const records = JSON.parse(localStorage.getItem('sudokuRecords') || '{}');
                
                if (!records[difficulty]) {
                    records[difficulty] = [];
                }
                
                const now = new Date();
                const dateStr = now.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }).replace(/\. /g, '.').replace(/\.$/, '');
                
                const timeStr = now.toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                
                records[difficulty].push({
                    time,
                    mistakes,
                    date: `${dateStr} ${timeStr}`
                });
                
                // ìµœê·¼ 5ê°œë§Œ ìœ ì§€
                records[difficulty] = records[difficulty]
                    .sort((a, b) => a.time.localeCompare(b.time))
                    .slice(0, 5);
                
                localStorage.setItem('sudokuRecords', JSON.stringify(records));
                displayRecords();
            } catch (e) {
                console.log('localStorage not available in this environment');
            }
        }

        function displayRecords() {
            const recordsList = document.getElementById('recordsList');
            
            try {
                const records = JSON.parse(localStorage.getItem('sudokuRecords') || '{}');
                const currentRecords = records[currentDifficulty] || [];
                
                if (currentRecords.length === 0) {
                    recordsList.innerHTML = '<div style="text-align: center; color: #999;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                recordsList.innerHTML = currentRecords
                    .map((record, index) => `
                        <div class="record-item">
                            <span>${index + 1}. ${record.time} (ì‹¤ìˆ˜: ${record.mistakes}íšŒ)</span>
                            <span style="color: #999; font-size: 10px;">${record.date}</span>
                        </div>
                    `)
                    .join('');
            } catch (e) {
                recordsList.innerHTML = '<div style="text-align: center; color: #999;">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><small>íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•´ì„œ ì—´ì–´ë³´ì„¸ìš”!</small></div>';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.number-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const num = parseInt(btn.dataset.number);
                placeNumber(num);
            });
        });

        document.getElementById('erase').addEventListener('click', eraseCell);
        document.getElementById('newGame').addEventListener('click', newGame);

        // ì„¤ì • ë²„íŠ¼
        document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
        
        // ê¸°ë¡ ì‚­ì œ ë²„íŠ¼
        document.getElementById('clearRecordsBtn').addEventListener('click', clearAllRecords);

        // ì„¤ì • ëª¨ë‹¬ ë‚´ ë‚œì´ë„ ë²„íŠ¼ë“¤
        document.querySelectorAll('.difficulty-btn-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.difficulty-btn-modal').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                changeDifficulty(btn.dataset.level);
            });
        });

        // ì„¤ì • ëª¨ë‹¬ ë‚´ AI ì†ë„ ìŠ¬ë¼ì´ë”
        document.getElementById('aiSpeedModal').addEventListener('input', (e) => {
            aiSpeed = parseInt(e.target.value);
            updateAiSpeedModal();
        });

        // AI í’€ì´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('aiSolve').addEventListener('click', startAiSolver);
        document.getElementById('stopAi').addEventListener('click', stopAiSolver);

        // í‚¤ë³´ë“œ ì…ë ¥
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '9') {
                placeNumber(parseInt(e.key));
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                eraseCell();
            }
        });

        // ê²Œì„ ì‹œì‘
        loadSettings();
        displayRecords();
        initBoard();
    </script>
</body>
</html>